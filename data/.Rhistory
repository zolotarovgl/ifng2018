#Comparing enriched reactome pathways among gene clusters with clusterProfiler
require(clusterProfiler)
data(gcSample)
library(clusterProfiler)
data(gcSample)
res <- compareCluster(gcSample, fun="enrichPathway")
#Visualizaing particular pathways: e.g. the first from our list
y[1,]
#Visualizaing particular pathways: e.g. the first from our list
y[1,1]
#Visualizaing particular pathways: e.g. the first from our list
y[1,2]
viewPathway(y[1,2], readable=TRUE, foldChange=genelist)
#Visualizaing particular pathways: e.g. the first from our list
duplicated(names(genelist))
#Visualizaing particular pathways: e.g. the first from our list
sum(duplicated(names(genelist)))
#Visualizaing particular pathways: e.g. the first from our list
duplicated(c(2,2,3))
#Visualizaing particular pathways: e.g. the first from our list
any(duplicated(res$symbol))
#Visualizaing particular pathways: e.g. the first from our list
res[duplicated(res$symbol)]
#Visualizaing particular pathways: e.g. the first from our list
res[duplicated(res$symbol),]
#Visualizaing particular pathways: e.g. the first from our list
genelist=na.omit(genelist)
viewPathway(y[1,2], readable=TRUE, foldChange=genelist)
duplicated(names(genelist))
genelist[duplicated(names(genelist))}
viewPathway(y[1,2], readable=TRUE, foldChange=genelist)
genelist[duplicated(names(genelist))]
#Visualizaing particular pathways: e.g. the first from our list
genelist=genelist[!is.na(names(genelist))]
genelist[duplicated(names(genelist))]
#Visualizaing particular pathways: e.g. the first from our list
genelist=genelist[!is.na(names(genelist))]
duplicated(names(genelist))
genelist[duplicated(names(genelist))]
viewPathway(y[1,2], readable=TRUE, foldChange=genelist)
genelist['67184']
viewPathway(y[1,2], readable=TRUE, foldChange=genelist)
genelist[-duplicated(names(genelist))]
genelistgenelist[-duplicated(names(genelist))]
genelist=genelist[-duplicated(names(genelist))]
viewPathway(y[1,2], readable=TRUE, foldChange=genelist)
x<-c(2,3,4,2,5)
duplicated(x)
duplicate(x)
duplicated(x)
x[-duplicated(x)]
duplicated(names(genelist)
sum(duplicated(names(genelist)))
genelist[duplicated(names(genelist))]
dim(genelist)
length(genelist)
genelist=genelist[-duplicated(names(genelist))] #omitting duplicates
length(genelist)
genelist=genelist[-duplicated(names(genelist))] #omitting duplicates
length(genelist)
y
y[1,2]
genelist[!duplicated(names(genelist))]
genelist=genelist[!duplicated(names(genelist))]
length(genelist)
viewPathway(y[1,2], readable=TRUE, foldChange=genelist)
viewPathway("E2F mediated regulation of DNA replication", readable=TRUE, foldChange=genelist)
y
genelist
y[1,2]
?viewPathway
viewPathway(y[1,2],oranism = 'mouse', readable=TRUE, foldChange=genelist)
cnetplot(x, categorySize="pvalue", foldChange=genelist,cex=0.01)
cnetplot(x, categorySize="pvalue", foldChange=genelist,cex=0.01)
x <- enrichPathway(gene=de,organism = 'mouse',pvalueCutoff=0.05, readable=T)
cnetplot(x, categorySize="pvalue", foldChange=genelist,cex=0.01)
grid.newpage()
par(cex=0.5)
par(cex=0.5)
par(cex=0.5)
cnetplot(x, categorySize="pvalue", foldChange=genelist,cex=0.01)
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
names(genelist)
names(genelist)=as.character(names(genelist))
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
select(org.Mm.eg.db, head(names(exonRanges)), "SYMBOL","FLYBASE")
select(org.Mm.eg.db, head(names(exonRanges)), "SYMBOL")
select(org.Mm.eg.db, head(names(genelist)), "SYMBOL")
geneslist
genelist
genelist = res$log2FoldChange
names(genelist) = res$entrez
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
#Visualizaing particular pathways: e.g. the first from our list
genelist=genelist[!is.na(names(genelist))] #omitting na
genelist=genelist[!duplicated(names(genelist))]#omitting duplicates
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
colnames(res)
names(genelist) = res$ensembl
#Visualizaing particular pathways: e.g. the first from our list
genelist = res$log2FoldChange
names(genelist) = res$ensembl
genelist=genelist[!is.na(names(genelist))] #omitting na
genelist=genelist[!duplicated(names(genelist))]#omitting duplicates
names(genelist)=as.character(names(genelist))
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
names(genelist) = res$ensembl
#Visualizaing particular pathways: e.g. the first from our list
genelist = res$log2FoldChange
names(genelist) = res$ensembl
genelist=genelist[!is.na(names(genelist))] #omitting na
genelist=genelist[!duplicated(names(genelist))]#omitting duplicates
names(genelist)=as.character(names(genelist))
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
#Visualizaing particular pathways: e.g. the first from our list
genelist = res$log2FoldChange
names(genelist) = res$entrez
genelist=genelist[!is.na(names(genelist))] #omitting na
genelist=genelist[!duplicated(names(genelist))]#omitting duplicates
names(genelist)=as.character(names(genelist))
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
keys(viewPathway())
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=geneList)
viewPathway("E2F mediated regulation of DNA replication",oranism = 'human', readable=TRUE, foldChange=geneList)
grid.newpage()
viewPathway("E2F mediated regulation of DNA replication",oranism = 'human', readable=TRUE, foldChange=geneList)
viewPathway("E2F mediated regulation of DNA replication",oranism = 'rat', readable=TRUE, foldChange=genelist)
genelist
'4'%in%names(genelist)
'4'%in%names(genelist)[1]
names(genelist)[1]
viewPathway("E2F mediated regulation of DNA replication",oranism = 'rat', readable=TRUE, foldChange=genelist)
emapplot(y, color="pvalue")
?emmaplot
??emmaplot
enrichMap(y)
#GSEA with reactome
y <- gsePathway(geneList, nPerm=1000,
minGSSize=120, pvalueCutoff=0.2,
pAdjustMethod="BH", verbose=FALSE)
rs <- as.data.frame(y)
head(rs)
View(as.data.frame(y))
enrichMap(y)
View(as.data.frame(y))
#GSEA with reactome
y <- gsePathway(geneList, nPerm=1000,
minGSSize=120, pvalueCutoff=0.2,
pAdjustMethod="BH", verbose=FALSE)
?gseaPathway
??gseaPathway
#GSEA with reactome
y <- gsePathway(genelist, nPerm=1000,organism = 'mouse'
minGSSize=120, pvalueCutoff=0.2,
pAdjustMethod="BH", verbose=FALSE)
#GSEA with reactome
y <- gsePathway(genelist, nPerm=1000,organism = 'mouse',
minGSSize=120, pvalueCutoff=0.2,
pAdjustMethod="BH", verbose=FALSE)
#GSEA with reactome
geneList
#GSEA with reactome
geneList[1]
#GSEA with reactome
geneList[100]
#GSEA with reactome
sort(genelist)
#GSEA with reactome
sort(genelist,decrease=T)
#GSEA with reactome
order(genelist,decreasing = T)
#GSEA with reactome
genelist[order(genelist,decreasing = T)
#GSEA with reactome
genelist[order(genelist,decreasing = T)}
y <- gsePathway(genelist, nPerm=1000,organism = 'mouse',
minGSSize=120, pvalueCutoff=0.2,
pAdjustMethod="BH", verbose=FALSE)
??gseaPathway
View(as.data.frame(y))
#gsea visualization
enrichMap(y)
#enrichment visualization
barplot(x, showCategory=8)
dotplot(x, showCategory=15)
enrichMap(x, layout=igraph::layout.kamada.kawai, vertex.label.cex = 1)
#In order to consider the potentially biological complexities in which a gene may belong to multiple annotation categories, we developed cnetplot function to extract the complex association between genes and diseases.
par(cex=0.5)
cnetplot(x, categorySize="pvalue", foldChange=genelist,cex=0.01)
grid.newpage()
help(par)
#Visualizaing particular pathways: e.g. the first from our list
genelist = res$log2FoldChange
names(genelist) = res$entrez
colnames(res)
genelist=genelist[!is.na(names(genelist))] #omitting na
genelist=genelist[!duplicated(names(genelist))]#omitting duplicates
names(genelist)=as.character(names(genelist))
viewPathway("E2F mediated regulation of DNA replication",oranism = 'rat', readable=TRUE, foldChange=genelist)
#GSEA with reactome
genelist[order(genelist,decreasing = T)]
#GSEA with reactome
genelist=genelist[order(genelist,decreasing = T)]
y <- gsePathway(genelist, nPerm=1000,organism = 'mouse',
minGSSize=120, pvalueCutoff=0.2,
pAdjustMethod="BH", verbose=FALSE)
View(as.data.frame(y))
??gseaPathway
write.csv(y,'gsea_reactopmePA',row.names = F)
write.csv(y,'gsea_reactopmePA.csv',row.names = F)
?enrichPathway
#exporting reactome assigned data
write.csv(y,'reactomepa_pathway.enrich.csv',row.names = F)
#exporting reactome assigned data
write.csv(y,'reactomepa_pathway_enrich.csv',row.names = F)
write.csv(y,'reactomepa_gsea.csv',row.names = F)
viewPathway("E2F mediated regulation of DNA replication",oranism = 'rat', readable=TRUE, foldChange=genelist)
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
?view(Pathways)
?viewPathway
data(geneList)
geneList
viewPathway("E2F mediated regulation of DNA replication", readable=TRUE, foldChange=geneList)
y[1,2]
viewPathway(y[1,2], readable=TRUE, foldChange=geneList)
grid.newpage()
viewPathway(y[1,2], readable=TRUE, foldChange=geneList)
grid.newpage()
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
genelist
names(genelist)=gsub(names(genelist),' ','')
genelist=genelist[!is.na(names(genelist))] #omitting na
genelist=genelist[!duplicated(names(genelist))]#omitting duplicates
#Visualizaing particular pathways: e.g. the first from our list
genelist = res$log2FoldChange
names(genelist) = res$entrez
colnames(res)
genelist=genelist[!is.na(names(genelist))] #omitting na
genelist=genelist[!duplicated(names(genelist))]#omitting duplicates
names(genelist)=gsub(' ','',names(genelist))
viewPathway("E2F mediated regulation of DNA replication",oranism = 'mouse', readable=TRUE, foldChange=genelist)
genelist
data(exampleRanks)
#---- fgsea analysis-----
data(examplePathways)
data(exampleRanks)
#---- fgsea analysis-----
data(examplePathways)
data(exampleRanks)
fgseaRes <- fgsea(pathways = examplePathways,
stats = exampleRanks,
minSize=15,
maxSize=500,
nperm=10000)
head(fgseaRes[order(pval), ])
exampleRanks
examplePathways
?fgsea
#---- additional visualization and analysis-----
data(geneList, package="DOSE")
gene <- names(geneList)[abs(geneList) > 2]
gene.df <- bitr(gene, fromType = "ENTREZID",
toType = c("ENSEMBL", "SYMBOL"),
OrgDb = org.Hs.eg.db)
head(gene.df)
ggo <- groupGO(gene     = gene,
OrgDb    = org.Hs.eg.db,
ont      = "CC",
level    = 3,
readable = TRUE)
barplot(ggo, drop=TRUE, showCategory=12)
gene
ggo <- groupGO(gene     = genelist,
OrgDb    = org.sMm.eg.db,
ont      = "CC",
level    = 3,
readable = TRUE)
ggo <- groupGO(gene     = genelist,
OrgDb    = org.Mm.eg.db,
ont      = "CC",
level    = 3,
readable = TRUE)
geneList
metadat
?results
res <- results(dds, contrast=c("cell_line",'TC1A9',"B19"))
res <- results(dds, contrast=c("treatment",'ifng',"control"))
res
#----Differential expression analysis ----
dds <- DESeq(dds)
dds
metadat
res <- results(dds, contrast=c("cell_line",'TC1A9',"B16"))
unique(metadat$cell_line)
res <- results(dds, contrast=c("cell_line",'TC1A9',"B16"))
summary(dds)
?DESeq
dds <- DESeqDataSetFromMatrix(countData = countdata,
colData = metadat,
design = ~ cell_line + treatment)
nrow(dds) # 46946 transcripts
dds$treatment <- relevel(dds$treatment, ref = "control") #making control level the reference one
#filtering low-abundant transcripts that have < than 10 transcripts total
keep <- rowSums(counts(dds)) >= 10
dds <- dds[keep,]
#----Differential expression analysis ----
dds <- DESeq(dds)
#----cell line analysis-----
res <- results(dds, contrast=c("cell_line",'TC1A9',"B16"))
res
dds <- DESeqDataSetFromMatrix(countData = countdata,
colData = metadat,
design = ~ cell_line + treatment)
#----Differential expression analysis ----
dds <- DESeq(dds)
#----cell line analysis-----
res <- results(dds, contrast=c("cell_line",'TC1A9',"B16"))
res
res[order(res$padj)]
res[order(res$padj),]
res = na.omit(res)
res[order(res$padj),]
# rlog transformation
rld <- rlog(dds, blind = FALSE)
# let's explore genes with strongest up-regulation
resSig <- subset(res, padj < 0.1)
head(resSig[ order(resSig$log2FoldChange,decreasing=T), ])
# and down-regulation
head(resSig[ order(resSig$log2FoldChange,decreasing=F), ])
#first gene in the list was downregulated 2^5 times
topGene <- rownames(res)[which.min(res$padj)]
plotCounts(dds, gene = topGene, intgroup=c("treatment"))
plotCounts(dds, gene = topGene, intgroup=c("treatment"))
#----Annotating genes ----
library("AnnotationDbi")
#downloading mouse annotation
library("org.Mm.eg.db")
res$symbol <- mapIds(org.Mm.eg.db,
keys=row.names(res),
column="SYMBOL",
keytype="ENSEMBL",
multiVals="first")
res$entrez <- mapIds(org.Mm.eg.db,
keys=row.names(res),
column="ENTREZID",
keytype="ENSEMBL",
multiVals="first")
res$ensembl=rownames(res)
#----Exploratory data analysis, distance between samples ----
#Bland-Altman plot
plotMA( res, ylim = c(-10, 10) )
#----Exploratory data analysis, distance between samples ----
#Bland-Altman plot
plotMA( res, ylim = c(-10, 10) )
#DeSeq2 dispersion estimates
plotDispEsts( dds, ylim = c(1e-6, 1e1) ) #dispesion shrinks with the increase of norm count, so dispersions were shrunken towards the trend line
#p-value histogram
hist(res$pvalue[res$baseMean > 1], breaks = 0:20/20,
col = "grey50", border = "white")
topVarGenes <- head(order(rowVars(assay(rld)), decreasing = TRUE), 20)
#The heatmap becomes more interesting if we do not look at absolute expression strength but rather at the amount by which each gene deviates in a specific sample from the genes average across all samples. Hence, we center each genes values across samples, and plot a heatmap (figure below). We provide a data.frame that instructs the pheatmap function how to label the columns.
mat  <- assay(rld)[ topVarGenes, ]
mat  <- mat - rowMeans(mat)
anno <- as.data.frame(colData(rld)[, c("cell_line","treatment")])
pheatmap(mat, annotation_col = anno,border_color = 'black',cellwidth=20,cellheight=20)
rownames(mat)
?pheatmap
topVarGenes <- head(order(rowVars(assay(rld)), decreasing = TRUE), 20)
#The heatmap becomes more interesting if we do not look at absolute expression strength but rather at the amount by which each gene deviates in a specific sample from the genes average across all samples. Hence, we center each genes values across samples, and plot a heatmap (figure below). We provide a data.frame that instructs the pheatmap function how to label the columns.
mat  <- assay(rld)[ topVarGenes, ]
mat  <- mat - rowMeans(mat)
anno <- as.data.frame(colData(rld)[, c("cell_line","treatment")])
pheatmap(mat, annotation_col = anno,border_color = 'black',cellwidth=20,cellheight=20)
rownames(mat)
?pheatmap
?resuts
?results
#----cell line analysis-----
#rerunnign analysis using smaller dataset of cells treated with ifgn only
res <- results(dds, contrast=c("cell_line",'TC1A9',"B16"))
res = na.omit(res)
res[order(res$padj),]
#The heatmap becomes more interesting if we do not look at absolute expression strength but rather at the amount by which each gene deviates in a specific sample from the genes average across all samples. Hence, we center each genes values across samples, and plot a heatmap (figure below). We provide a data.frame that instructs the pheatmap function how to label the columns.
mat  <- assay(rld)[ topVarGenes, ]
mat  <- mat - rowMeans(mat)
anno <- as.data.frame(colData(rld)[, c("cell_line","treatment")])
pheatmap(mat, annotation_col = anno,border_color = 'black',cellwidth=20,cellheight=20)
rownames(mat)
#----cell line analysis-----
#rerunnign analysis using smaller dataset of cells treated with ifgn only
countdata
metadat
metadat[metadat$treatment=='control']
metadat[metadat$treatment=='control',]
metadat[-metadat$treatment=='control',]
metadat[!metadat$treatment=='control',]
metadat=metadat[!metadat$treatment=='control',]
#----cell line analysis-----
#rerunnign analysis using smaller dataset of cells treated with ifgn only
countdata
metadat
#----cell line analysis-----
#rerunnign analysis using smaller dataset of cells treated with ifgn only
countdata[,matadat$sample_name]
countdata[,metadat$sample_name]
countdata=countdata[,metadat$sample_name]
dds <- DESeqDataSetFromMatrix(countData = countdata,
colData = metadat,
design = ~ cell_line)
dds
metadat
metadat[!metadat$treatment=='control',-3]
#----cell line analysis-----
#rerunnign analysis using smaller dataset of cells treated with ifgn only
metadat=metadat[!metadat$treatment=='control',-3]
countdata=countdata[,metadat$sample_name]
metadat$sample_name
countdata=countdata[,metadat$sample_name]
countdata=countdata[,metadat$sample_name]
#----cell line analysis-----
#rerunnign analysis using smaller dataset of cells treated with ifgn only
metadat=metadat[!metadat$treatment=='control',-3]
countdata=countdata[,metadat$sample_name]
dds <- DESeqDataSetFromMatrix(countData = countdata,
colData = metadat,
design = ~ cell_line)
#----Reading our primitive metadata----
metadat = read.csv("metadat.csv",sep = ';')
# Setting a working directory
setwd("/Users/macbook/embl_transcriptom/tr_analysis")
setwd("/Users/macbook/embl_transcriptom/data")
list.files(pattern = 'Sample')
list.files()
#----Reading our primitive metadata----
metadat = read.csv("metadat.csv",sep = ';')
all(metadat$sample_name == colnames(data))#checking direct correspondence
#----cell line analysis-----
#rerunnign analysis using smaller dataset of cells treated with ifgn only
metadat=metadat[!metadat$treatment=='control',]
metadat = matadat[,-3]
metadat = metadat[,-3]
countdata=countdata[,metadat$sample_name]
metadat$sample_name
countdata
data
countdata = data
countdata=countdata[,metadat$sample_name]
dds <- DESeqDataSetFromMatrix(countData = countdata,
colData = metadat,
design = ~ cell_line)
dds
dds <- DESeq(dds)
results(dds)
res=na.omit(results(dds))
res$symbol <- mapIds(org.Mm.eg.db,
keys=row.names(res),
column="SYMBOL",
keytype="ENSEMBL",
multiVals="first")
res$entrez <- mapIds(org.Mm.eg.db,
keys=row.names(res),
column="ENTREZID",
keytype="ENSEMBL",
multiVals="first")
res$ensembl=rownames(res)
sum(res$padj < 0.01&abs(res$log2FoldChange)>=1, na.rm=TRUE) # 606 genes have adjusted p-value<0.01 and log2 fold change
res = na.omit(res) #omittnig NAs
sum(res$padj < 0.01&abs(res$log2FoldChange)>=1, na.rm=TRUE) # 606 genes have adjusted p-value<0.01 and log2 fold change
res = na.omit(res) #omittnig NAs
sum(res$padj < 0.01&abs(res$log2FoldChange)>=1, na.rm=TRUE) # 606 genes have adjusted p-value<0.01 and log2 fold change
# let's explore genes with strongest up-regulation
resSig <- subset(res, padj < 0.1)
head(resSig[ order(resSig$log2FoldChange,decreasing=T), ])
# and down-regulation
head(resSig[ order(resSig$log2FoldChange,decreasing=F), ])
#first gene in the list was downregulated 2^5 times
topGene <- rownames(res)[which.min(res$padj)]
plotCounts(dds, gene = topGene, intgroup=c("treatment"))
#----Exploratory data analysis, distance between samples ----
#Bland-Altman plot
plotMA( res, ylim = c(-10, 10) )
#----Exploratory data analysis, distance between samples ----
#Bland-Altman plot
plotMA(res, ylim = c(-10, 10) )
#DeSeq2 dispersion estimates
plotDispEsts( dds, ylim = c(1e-6, 1e1) ) #dispesion shrinks with the increase of norm count, so dispersions were shrunken towards the trend line
topVarGenes <- head(order(rowVars(assay(rld)), decreasing = TRUE), 20)
#The heatmap becomes more interesting if we do not look at absolute expression strength but rather at the amount by which each gene deviates in a specific sample from the genes average across all samples. Hence, we center each genes values across samples, and plot a heatmap (figure below). We provide a data.frame that instructs the pheatmap function how to label the columns.
mat  <- assay(rld)[ topVarGenes, ]
mat  <- mat - rowMeans(mat)
anno <- as.data.frame(colData(rld)[, c("cell_line","treatment")])
pheatmap(mat, annotation_col = anno,border_color = 'black',cellwidth=20,cellheight=20)
pheatmap(mat, annotation_col = anno,border_color = 'black',cellwidth=20,cellheight=20)
#Gene clustering
#Let's cluster 20 genes with the highest variance across the samples
dev.off()
topVarGenes <- head(order(rowVars(assay(rld)), decreasing = TRUE), 20)
#The heatmap becomes more interesting if we do not look at absolute expression strength but rather at the amount by which each gene deviates in a specific sample from the genes average across all samples. Hence, we center each genes values across samples, and plot a heatmap (figure below). We provide a data.frame that instructs the pheatmap function how to label the columns.
mat  <- assay(rld)[ topVarGenes, ]
mat  <- mat - rowMeans(mat)
anno <- as.data.frame(colData(rld)[, c("cell_line","treatment")])
pheatmap(mat, annotation_col = anno,border_color = 'black',cellwidth=20,cellheight=20)
#p-value histogram
hist(res$pvalue[res$baseMean > 1], breaks = 0:20/20,
col = "grey50", border = "white")
plot(cars)
plot(cars)
par(mfrow=c(2,2))
plot(cars)
plot.new()
sessionInfo()
